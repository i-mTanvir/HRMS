<?php
include "connection.php";

$id = isset($_GET["id"]) ? intval($_GET["id"]) : 0;
if ($id <= 0) {
    die("Invalid customer id");
}

$stmt = mysqli_prepare($con, "SELECT * FROM customers WHERE id = ?");
mysqli_stmt_bind_param($stmt, "i", $id);
mysqli_stmt_execute($stmt);
$result = mysqli_stmt_get_result($stmt);
$row = mysqli_fetch_assoc($result);
mysqli_stmt_close($stmt);

if (!$row) {
    die("Customer not found");
}

// Fetch latest 3 products with average rating
$servicesSql = "
    SELECT
        p.id,
        p.product_name,
        p.price,
        COALESCE(AVG(s.star), NULL) AS avg_star
    FROM product p
    LEFT JOIN services s ON s.product_id = p.id AND s.star IS NOT NULL
    GROUP BY p.id, p.product_name, p.price
    ORDER BY p.id DESC
    LIMIT 3";
$servicesResult = mysqli_query($con, $servicesSql);
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard</title>
    <link rel="stylesheet" href="customer_dashboard.css">
</head>
<body>
<?php include "cnav.php"; ?>

    <div id="hero">
        <div id="hero-left">
            <div id="hero-title">
                <div>Expert & Hassle-Free</div>
                <div>Solutions for Your</div>
                <div class="typing-wrapper">
                    <span id="typing-text" class="typing-demo"></span>
                </div>
            </div>
            <div id="hero-subtitle">
                Need a trusted repair pro? Find and book the right specialist online, choose your time, and get transparent pricing for a quick, reliable fix.
            </div>
            <a id="hero-search" href="services.php?id=<?php echo $row['id']; ?>">
                <div id="search-icon">üîç</div>
                <span id="search-input">Search ...</span>
            </a>
        </div>
        <div id="hero-right">
            <img id="hero-image" src="media/hero.png" alt="Technician">
        </div>
    </div>

    <div id="stats-banner">
        <div id="rating">
            <span>‚òÖ</span><span>‚òÖ</span><span>‚òÖ</span><span>‚òÖ</span><span>‚òÖ</span>
        </div>
        <div id="stat-one">
            <div class="stat-number">21K+</div>
            <div class="stat-label">Project Done</div>
        </div>
        <div id="stat-two">
            <div class="stat-number">21K+</div>
            <div class="stat-label">Project Done</div>
        </div>
        <div id="stat-three">
            <div class="stat-number">21K+</div>
            <div class="stat-label">Project Done</div>
        </div>
    </div>

    <div id="our-services">
        <h2>Our Services</h2>
        <div id="service-cards">
            <div class="card" id="card-1">
                <img src="media/service-1.png" alt="AC Repair">
                <h3>AC Repair</h3>
                <p>Rating: 4.5 ‚òÖ</p>
                <div class="card-bottom">
                    <span class="price">Tk 580</span>
                    <button class="cta-button">Book</button>
                </div>
            </div>

            <div class="card" id="card-2">
                <img src="media/service-2.png" alt="TV Repair">
                <h3>TV Repair</h3>
                <p>Rating: 4.6 ‚òÖ</p>
                <div class="card-bottom">
                    <span class="price">Tk 650</span>
                    <button class="cta-button">Book</button>
                </div>
            </div>

            <div class="card" id="card-3">
                <img src="media/service-3.png" alt="Fridge Repair">
                <h3>Fridge Repair</h3>
                <p>Rating: 4.7 ‚òÖ</p>
                <div class="card-bottom">
                    <span class="price">Tk 720</span>
                    <button class="cta-button">Book</button>
                </div>
            </div>
        </div>

        <div id="explore-more">
            <a class="cta-button" href="services.php?id=<?php echo $row['id']; ?>">Explore More</a>
        </div>
    </div>

    <div id="contact-section">
        <div id="contact-left">
            <h2>Contact Us</h2>
            <form id="contact-form">
                <label for="name">Name</label><br>
                <input type="text" id="name" name="name" placeholder="Enter Name"><br><br>

                <label for="email">Email</label><br>
                <input type="email" id="email" name="email" placeholder="Enter Email"><br><br>

                <label for="feedback">Write your feedback/suggestions</label><br>
                <textarea id="feedback" name="feedback" rows="5" placeholder="Enter your feedback..."></textarea><br><br>

                <button type="submit" class="cta-button">Send</button>
            </form>
        </div>

        <div id="contact-right">
            <img src="media/contact.png" alt="Contact Us">
        </div>
    </div>

    <div id="footer">
        <div id="footer-links">
            <h4>Important Links</h4>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Services</a></li>
                <li><a href="#">Pricing</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </div>

        <div id="footer-address">
            <h4>Address</h4>
            <p>123, RIPO Service Center, Dhaka, Bangladesh</p>
            <p>Hotline: 996644</p>
        </div>

        <div id="footer-social">
            <h4>Follow Us</h4>
            <ul>
                <li><a href="#">Facebook</a></li>
                <li><a href="#">Instagram</a></li>
                <li><a href="#">LinkedIn</a></li>
            </ul>
        </div>
    </div>

    <div id="footer-bottom">
        <p>All Rights Reserved. Developed by Tanvir, Rakib, Raichy.</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const typingEl = document.getElementById('typing-text');
            if (!typingEl) return;

            const services = [
                'Home Appliances',
                'Electrical Work',
                'Plumbing Needs',
                'Refrigerator Repair'
            ];

            let index = 0;
            const typingSpeed = 90;
            const eraseSpeed = 55;
            const holdTime = 1200;

            function cycleText() {
                const text = services[index];
                typingEl.textContent = text;
                typingEl.style.width = 'auto';
                typingEl.style.setProperty('--typing-width', `${typingEl.scrollWidth}px`);
                typingEl.style.removeProperty('width');
                typingEl.style.setProperty('--typing-chars', text.length);
                typingEl.classList.remove('erasing');
                void typingEl.offsetWidth;
                typingEl.classList.add('typing');

                const typeDuration = text.length * typingSpeed;

                setTimeout(() => {
                    typingEl.classList.remove('typing');
                    typingEl.classList.add('erasing');

                    const eraseDuration = text.length * eraseSpeed;
                    setTimeout(() => {
                        typingEl.classList.remove('erasing');
                        index = (index + 1) % services.length;
                        cycleText();
                    }, eraseDuration);
                }, typeDuration + holdTime);
            }

            cycleText();
        });
    </script>
</body>
</html>

